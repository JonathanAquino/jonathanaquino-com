function processTransformationFilters(a){var d,b="",c="";d=a.length;for(var e=0;e<d;e++)c=processSingleFilter(a[e]),""!=c&&(b+=c,b+="/");return b.substring(0,b.length-1)}function processSingleFilter(a){var b="",c="";for(var d in a)a.hasOwnProperty(d)&&(c=convertPhpThumbFilter(d,a[d]),""!=c&&(b+=c,b+="/"));return b.substring(0,b.length-1)}function convertPhpThumbFilter(a,b){var c="";switch(a){case"width":c="w:"+b;break;case"height":c="h:"+b;break;case"crop":c="zc:1";break;case"cropByMargin":c="fltr:crop~"+b.replace(/ /g,"~");break;case"grayscale":b&&(c="fltr:gray");break;case"blur":b&&(c="number"==typeof b?"fltr:blur~"+b:"fltr:gblr");break;case"saturation":c="fltr:sat~"+b;break;case"contrast":c="fltr:cont~"+b;break;case"level":c="fltr:lvl~"+b.replace(/ /g,"~");break;case"format":c="f:"+b;break;case"bitrate":c="b:"+b}return c}function sendXhrRequest(a,b){var c=new XMLHttpRequest;return c.open("GET",a,!1),c.send(),c}function getNextVal(a,b){var c;a.sort(function(a,b){return a-b});for(var d=0;d<a.length;d++)(null==c||Math.abs(a[d]-b)<Math.abs(c-b))&&(c=a[d]);return c<=b&&(c=a[a.indexOf(c)+1]?a[a.indexOf(c)+1]:a[a.indexOf(c)]),c}function isEmpty(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return JSON.stringify(a)===JSON.stringify({})}var BlobManager={transform:function(a,b){var c,d,e,f,g,h,i;return a&&b&&""!=a&&""!=b&&"undefined"!=typeof a&&"undefined"!=typeof b?(c="string"==typeof b?b:processTransformationFilters(b),e=a.split("/files/"),e[0]?(f=e[0],e[1]?(g=e[1].split("/"),h="/files/"+g[0]+"/"+g[1]+"/"+g[2],i=g[g.length-1],""!=c?(i=this.getTransformFileName(i,c),d=f+h+"/"+c+"/"+i):d=f+h+"/"+i,d):"#"):"#"):"#"},getTransformFileName:function(a,b){var c,d,e,f="";c=b.split("/"),d=c.length;for(var g=0;g<d;g++)c[g].indexOf("f:")!==-1&&(f=c[g].replace("f:",""));return""!=f&&(e=a.split("."),a=e[1]?a.replace(e[1],f):a+"."+f),a},status:function(a){var b,c;return a&&""!=a&&"undefined"!=typeof a?(b=a.replace("/files/","/status/"),b=b.replace(this.oldSubdomain,this.newSubdomain),c=sendXhrRequest(b),c.responseText):"#"},getPreviewImage:function(a,b,c){if(a&&""!=a&&"undefined"!=typeof a){var e,d=this.status(a),f="",d=JSON.parse(d);return attachment=d.attachment,"undefined"==typeof attachment||isEmpty(attachment)||(f=attachment.data.url,e=attachment.data.filename,transformation="","undefined"!=typeof b&&""!=b&&(transformation+="w:"+b+"/"),"undefined"!=typeof c&&""!=c&&(transformation+="h:"+c+"/"),""!=transformation&&(f=f.replace(e,transformation+e))),f}},getPreviewVideo:function(a,b,c){if(a&&""!=a&&"undefined"!=typeof a&&b&&""!=b&&"undefined"!=typeof b&&c&&""!=c&&"undefined"!=typeof c){var e,j,k,d=this.status(a),f="",g=[],h=[],i={},l=this.defaultFormat;for(preview=this.previewFormat,d=JSON.parse(d),presetData=d.transformations,j=presetData.length,e=0;e<j;e++)"COMPLETED"===presetData[e].status&&presetData[e].data.url.indexOf(l)!==-1&&presetData[e].data.url.indexOf(preview)!==-1&&(k=presetData[e].data.width+"x"+presetData[e].data.height,g.push(presetData[e].data.width),h.push(presetData[e].data.height),i[k]=presetData[e].data.url);return isEmpty(i)||(suitablePresetWidth=getNextVal(g,b),suitablePresetHeight=getNextVal(h,c),suitablePresetKey=suitablePresetWidth+"x"+suitablePresetHeight,f=i[suitablePresetKey]),f}},suitableTransform:function(a,b,c,d){var f,i,e=this.status(a),g=[],h={},j=b?b:this.defaultFormat;for(preview=this.previewFormat,e=JSON.parse(e),e=e.transformations,i=e.length,f=0;f<i;f++)"COMPLETED"===e[f].status&&e[f].data.url.indexOf(j)!==-1&&e[f].data.url.indexOf(preview)===-1&&(g.push(e[f].data.width),h[e[f].data.width]=e[f].data.url);return suitablePresetWidth=getNextVal(g,c),h[suitablePresetWidth]},previewFormat:"preview",defaultFormat:".mp4",oldSubdomain:"//cdn.",newSubdomain:"//cdn-orig."};